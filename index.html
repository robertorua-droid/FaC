<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionale Cloud - Professionisti</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Login -->
    <div id="login-container" class="container">
        <div class="row justify-content-center align-items-center vh-100">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h3 class="card-title text-center mb-4">Accesso Cloud</h3>
                        <form id="login-form">
                            <div class="mb-3"><label class="form-label">Email</label><input type="email" class="form-control" id="email" required></div>
                            <div class="mb-3"><label class="form-label">Password</label><input type="password" class="form-control" id="password" required></div>
                            <div id="login-error" class="text-danger mb-3 d-none">Credenziali errate.</div>
                            <button type="submit" class="btn btn-primary w-100" id="btn-login-submit">Accedi</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div id="loading-screen" class="d-flex justify-content-center align-items-center vh-100 d-none bg-white" style="position:fixed; top:0; left:0; width:100%; z-index:2000;">
        <div class="text-center"><div class="spinner-border text-primary" role="status"></div><p class="mt-3">Sincronizzazione...</p></div>
    </div>

    <!-- App -->
    <div id="main-app" class="d-none">
        <div class="sidebar">
            <h4 class="text-center my-3" id="company-name-sidebar">MIO STUDIO</h4>
            <p class="text-center text-white-50 small" id="user-name-sidebar"></p>
            <p class="text-center text-white-50" style="font-size: 0.7rem;">v9.0 (Modular)</p>
            <ul class="nav flex-column">
                <li class="nav-item"><a class="nav-link active" href="#" data-target="home"><i class="fas fa-home"></i> Home</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-target="statistiche"><i class="fas fa-chart-line"></i> Statistiche</a></li>
                <li class="nav-item"><h6 class="nav-section-title">Anagrafiche</h6></li>
                <li class="nav-item"><a class="nav-link" href="#" data-target="anagrafica-clienti"><i class="fas fa-users"></i> Clienti</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-target="anagrafica-prodotti"><i class="fas fa-box"></i> Servizi</a></li>
                <li class="nav-item"><h6 class="nav-section-title">Documenti</h6></li>
                <li class="nav-item"><a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#newInvoiceChoiceModal" id="menu-nuova-fattura"><i class="fas fa-file-invoice-dollar"></i> Nuova Fattura</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-target="nuova-fattura-accompagnatoria" id="menu-nuova-nota-credito"><i class="fas fa-file-download"></i> Nuova Nota Credito</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-target="elenco-fatture"><i class="fas fa-list-ol"></i> Elenco Documenti</a></li>
                <li class="nav-item"><h6 class="nav-section-title">Impostazioni</h6></li>
                <li class="nav-item"><a class="nav-link" href="#" data-target="anagrafica-azienda"><i class="fas fa-building"></i> Azienda</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-target="avanzate"><i class="fas fa-cloud-upload-alt"></i> Migrazione</a></li>
                <li class="nav-item mt-auto"><a class="nav-link" href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </div>

        <div class="main-content">
            <div id="home" class="content-section"><h2 id="welcome-message">Benvenuto</h2><p id="current-datetime" class="lead"></p><hr><div class="row mt-4"><div class="col-md-6"><div id="calendar-widget"></div></div><div class="col-md-6"><div class="card"><div class="card-body"><h5>Note</h5><textarea id="notes-textarea" class="form-control" rows="8"></textarea><button class="btn btn-primary btn-sm mt-2" id="save-notes-btn">Salva</button></div></div></div></div></div>
            <div id="statistiche" class="content-section d-none"><h2>Statistiche</h2><div id="stats-table-container"></div><hr><div id="tax-simulation-container"></div></div>
            <div id="anagrafica-clienti" class="content-section d-none"><h2>Clienti <button class="btn btn-success float-end" id="newCustomerBtn">Nuovo</button></h2><table class="table table-hover"><thead><tr><th>Ragione Sociale</th><th>P.IVA</th><th>S.d.I.</th><th>Indirizzo</th><th class="text-end">Azioni</th></tr></thead><tbody id="customers-table-body"></tbody></table></div>
            <div id="anagrafica-prodotti" class="content-section d-none"><h2>Servizi <button class="btn btn-success float-end" id="newProductBtn">Nuovo</button></h2><table class="table table-hover"><thead><tr><th>Codice</th><th>Descrizione</th><th class="text-end">Prezzo</th><th class="text-end">IVA</th><th class="text-end">Azioni</th></tr></thead><tbody id="products-table-body"></tbody></table></div>
            <div id="elenco-fatture" class="content-section d-none"><h2>Documenti</h2><table class="table table-hover"><thead><tr><th>Tipo</th><th>Numero</th><th>Data</th><th>Cliente</th><th class="text-end">Totale</th><th class="text-end">Scadenza</th><th>Stato</th><th class="text-end">Azioni</th></tr></thead><tbody id="invoices-table-body"></tbody></table></div>
            
            <div id="nuova-fattura-accompagnatoria" class="content-section d-none">
                <h2 id="document-title">Nuovo Documento</h2>
                <form id="new-invoice-form">
                    <input type="hidden" id="editing-invoice-id"><input type="hidden" id="document-type" value="Fattura">
                    <div id="credit-note-fields" class="row d-none bg-light p-3 rounded mb-3">
                        <div class="col-md-6"><label>Fattura da Rettificare</label><input type="text" class="form-control" id="linked-invoice" placeholder="Es. FATT-2025-01"></div>
                        <div class="col-md-6"><label>Causale</label><input type="text" class="form-control" id="reason"></div>
                    </div>
                    <div class="row"><div class="col-md-6"><label>Cliente</label><select class="form-select" id="invoice-customer-select" required></select></div><div class="col-md-3"><label>Data</label><input type="date" class="form-control" id="invoice-date" required></div><div class="col-md-3"><label>Numero</label><input type="text" class="form-control" id="invoice-number"></div></div>
                    <hr>
                    <div class="row align-items-end g-2"><div class="col-lg-3"><select class="form-select" id="invoice-product-select"></select></div><div class="col-lg-3"><input type="text" class="form-control" id="invoice-product-description" readonly></div><div class="col-lg-1"><input type="number" class="form-control" id="invoice-product-qty" value="1"></div><div class="col-lg-2"><input type="number" class="form-control" id="invoice-product-price"></div><div class="col-lg-1"><select class="form-select" id="invoice-product-iva" disabled><option value="0">0%</option><option value="22">22%</option></select></div><div class="col-lg-1 d-none" id="invoice-esenzione-iva-container"><select class="form-select" id="invoice-product-esenzioneIva" disabled><option value="N2.2">N2.2</option></select></div><div class="col-lg-1"><button type="button" class="btn btn-secondary w-100" id="add-product-to-invoice-btn">+</button></div></div>
                    <table class="table mt-3"><thead><tr><th>Desc</th><th class="text-end">Qt</th><th class="text-end">Prezzo</th><th class="text-end">Tot</th><th></th></tr></thead><tbody id="invoice-lines-tbody"></tbody></table>
                    <div class="row mt-4"><div class="col-md-6"><label>Condizioni</label><input type="text" class="form-control" id="invoice-condizioniPagamento"></div><div class="col-md-6"><label>Modalità</label><input type="text" class="form-control" id="invoice-modalitaPagamento"></div></div>
                    <div class="row mt-2"><div class="col-md-3"><label>Data Rif.</label><input type="date" class="form-control" id="invoice-dataRiferimento"></div><div class="col-md-2"><label>Giorni</label><input type="number" class="form-control" id="invoice-giorniTermini"></div><div class="col-md-3"><label>Scadenza</label><input type="date" class="form-control" id="invoice-dataScadenza"></div></div>
                    <div class="text-end mt-3"><h3>Totale: <span id="invoice-total">0.00</span></h3></div>
                    <button type="submit" class="btn btn-primary mt-3">Salva</button>
                </form>
            </div>

            <div id="anagrafica-azienda" class="content-section d-none"><h2>Azienda</h2><form id="company-info-form"><div class="row"><div class="col-md-6"><label>Ragione Sociale</label><input type="text" class="form-control" id="company-name"></div><div class="col-md-3"><label>Cognome</label><input type="text" class="form-control" id="company-cognome"></div><div class="col-md-3"><label>Nome</label><input type="text" class="form-control" id="company-nome"></div></div><div class="row mt-2"><div class="col-md-8"><label>Indirizzo</label><input type="text" class="form-control" id="company-address"></div><div class="col-md-4"><label>Civico</label><input type="text" class="form-control" id="company-numeroCivico"></div></div><div class="row mt-2"><div class="col-md-4"><label>Città</label><input type="text" class="form-control" id="company-city"></div><div class="col-md-2"><label>CAP</label><input type="text" class="form-control" id="company-zip"></div><div class="col-md-2"><label>Prov</label><input type="text" class="form-control" id="company-province"></div><div class="col-md-4"><label>Nazione</label><input type="text" class="form-control" id="company-nazione" value="Italia"></div></div><hr><div class="row"><div class="col-md-3"><label>P.IVA</label><input type="text" class="form-control" id="company-piva"></div><div class="col-md-3"><label>C.F.</label><input type="text" class="form-control" id="company-codiceFiscale"></div><div class="col-md-3"><label>Regime</label><input type="text" class="form-control" id="company-regimeFiscale" value="Forfettario"></div><div class="col-md-3"><label>Cod. Regime</label><input type="text" class="form-control" id="company-codiceRegimeFiscale" value="RF19"></div></div><div class="row mt-2"><div class="col-md-3"><label>Coeff. %</label><input type="number" class="form-control" id="company-coefficienteRedditivita"></div><div class="col-md-3"><label>Imposta %</label><input type="number" class="form-control" id="company-aliquotaSostitutiva"></div><div class="col-md-3"><label>INPS %</label><input type="number" class="form-control" id="company-aliquotaContributi"></div><div class="col-md-3"><label>Rivalsa %</label><input type="number" class="form-control" id="company-aliquotaInps"></div></div><hr><div class="row"><div class="col-md-6"><label>Banca</label><input type="text" class="form-control" id="company-banca"></div><div class="col-md-6"><label>IBAN</label><input type="text" class="form-control" id="company-iban"></div></div><button type="submit" class="btn btn-primary mt-3">Salva</button></form></div>
            <div id="avanzate" class="content-section d-none"><h2>Migrazione</h2><div class="card mt-4"><div class="card-body"><h5 class="card-title">Importa Backup</h5><input type="file" id="import-file-input" class="form-control mt-2"></div></div></div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal fade" id="newInvoiceChoiceModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Nuova Fattura</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><button class="btn btn-primary w-100 mb-2" id="btn-create-new-blank-invoice">Vuota</button><select class="form-select mb-2" id="copy-from-invoice-select"><option>Copia da...</option></select><button class="btn btn-secondary w-100" id="btn-copy-from-invoice">Copia</button></div></div></div></div>
    <div class="modal fade" id="productModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="productModalTitle">Servizio</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form id="productForm">
        <!-- ID ORA VISIBILE MA NON MODIFICABILE -->
        <div class="mb-2 p-2 bg-light rounded">
            <label class="small text-muted">ID Scheda (Non modificabile)</label>
            <input type="text" class="form-control-plaintext fw-bold" id="product-id" readonly placeholder="Nuovo inserimento">
        </div>
        <div class="row"><div class="col-8"><label>Descrizione</label><input type="text" class="form-control" id="product-description"></div><div class="col-4"><label>Codice</label><input type="text" class="form-control" id="product-code"></div></div><div class="row mt-2"><div class="col-4"><label>Prezzo</label><input type="number" class="form-control" id="product-salePrice"></div><div class="col-4"><label>IVA</label><select class="form-select" id="product-iva"><option value="0">0%</option><option value="22">22%</option></select></div><div class="col-4 d-none" id="esenzione-iva-container"><label>Esenzione</label><select class="form-select" id="product-esenzioneIva"><option value="N2.2">N2.2</option></select></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-primary" id="saveProductBtn">Salva Servizio</button></div></div></div></div>
    <div class="modal fade" id="productModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="productModalTitle">Servizio</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form id="productForm"><input type="hidden" id="product-id"><div class="row"><div class="col-8"><label>Descrizione</label><input type="text" class="form-control" id="product-description"></div><div class="col-4"><label>Codice</label><input type="text" class="form-control" id="product-code"></div></div><div class="row mt-2"><div class="col-4"><label>Prezzo</label><input type="number" class="form-control" id="product-salePrice"></div><div class="col-4"><label>IVA</label><select class="form-select" id="product-iva"><option value="0">0%</option><option value="22">22%</option></select></div><div class="col-4 d-none" id="esenzione-iva-container"><label>Esenzione</label><select class="form-select" id="product-esenzioneIva"><option value="N2.2">N2.2</option></select></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-primary" id="saveProductBtn">Salva</button></div></div></div></div>
    <div class="modal fade" id="invoiceDetailModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header no-print"><h5 class="modal-title" id="invoiceDetailModalTitle">Dettaglio</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body" id="invoiceDetailModalBody"></div><div class="modal-footer no-print"><button class="btn btn-info" id="export-xml-btn">XML</button><button class="btn btn-primary" id="print-invoice-btn">Stampa</button></div></div></div></div>

    <!-- Libraries -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Modules -->
    <script src="config.js"></script>
    <script src="utils.js"></script>
    <script src="data.js"></script>
    <script src="ui.js"></script>
    <script src="main.js"></script>
</body>
</html>